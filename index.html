<link rel="stylesheet" href="static/css/index.css">
<!-- ✂️ 作者信息置顶并美化 -->
<div id="profile" class="card-info-avatar is-center">
  <img class="avatar-img" src="https://avatars.githubusercontent.com/u/9919?s=200&v=4" alt="avatar">
  <div class="author-info__name">Jinglong</div>
  <div class="author-info__description">学无止境</div>
</div>

<!-- ✂️ 登录模块 -->
<hr>
<h2>登录</h2>
<div id="login-container" class="tool">
  <input type="password" id="password-input" placeholder="输入密码...">
  <button onclick="login()">登录</button>
  <div id="login-status"></div>
</div>

<!-- ✂️ 待办事项模块插入位置 -->
<hr>
<h2>待办事项</h2>
<div id="todo-container" class="tool">
  <input type="text" id="todo-input" placeholder="输入待办事项..." disabled>
  <button onclick="addTodo()" disabled>添加</button>
  <ul id="todo-list"></ul>
</div>

<script>
  let isLoggedIn = false;

  function login() {
    const password = document.getElementById('password-input').value;
    const loginStatus = document.getElementById('login-status');
    if (password === 'djl20000828') { // 设置一个简单的密码
      isLoggedIn = true;
      loginStatus.textContent = '登录成功！';
      loginStatus.style.color = 'green';
      document.getElementById('todo-input').disabled = false;
      document.querySelector('#todo-container button').disabled = false;
    } else {
      loginStatus.textContent = '密码错误，请重试。';
      loginStatus.style.color = 'red';
    }
  }

  function addTodo() {
    if (!isLoggedIn) {
      alert('请先登录！');
      return;
    }
    const input = document.getElementById('todo-input');
    const text = input.value.trim();
    if (!text) return;
    const li = document.createElement('li');
    li.textContent = text;
    li.onclick = () => li.classList.toggle('completed');

    const del = document.createElement('span');
    del.textContent = '✖';
    del.onclick = (e) => {
      e.stopPropagation();
      li.remove();
      saveTodos(); // 保存更新后的待办事项
    };
    li.appendChild(del);

    document.getElementById('todo-list').appendChild(li);
    input.value = '';
    saveTodos(); // 保存待办事项
  }

  function saveTodos() {
    const todos = [];
    document.querySelectorAll('#todo-list li').forEach((li) => {
      todos.push({
        text: li.firstChild.textContent,
        completed: li.classList.contains('completed'),
      });
    });
    localStorage.setItem('todos', JSON.stringify(todos));
  }

  function loadTodos() {
    const todos = JSON.parse(localStorage.getItem('todos')) || [];
    const todoList = document.getElementById('todo-list');
    todoList.innerHTML = ''; // 清空列表
    todos.forEach((todo) => {
      const li = document.createElement('li');
      li.textContent = todo.text;
      if (todo.completed) li.classList.add('completed');
      li.onclick = () => li.classList.toggle('completed');

      const del = document.createElement('span');
      del.textContent = '✖';
      del.onclick = (e) => {
        e.stopPropagation();
        li.remove();
        saveTodos(); // 保存更新后的待办事项
      };
      li.appendChild(del);

      todoList.appendChild(li);
    });
  }

  // 在页面加载时自动加载待办事项
  window.onload = loadTodos;
</script>